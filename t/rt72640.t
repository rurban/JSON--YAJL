#!/usr/bin/perl
use strict;
use warnings;
use Test::More;

use JSON::YAJL;

my $text;
my $parser = JSON::YAJL::Parser->new(
    0, 0,
    [   sub { $text .= "null\n" },
        sub { $text .= "bool: @_\n" },
        undef,
        undef,
        sub { $text .= "number: @_\n" },
        sub { $text .= "string: @_\n" },
        sub { $text .= "map_open\n" },
        sub { $text .= "string: @_\n" },
        sub { $text .= "map_close\n" },
        sub { $text .= "array_open\n" },
        sub { $text .= "array_close\n" },
    ]
);

while (<DATA>) {
    $parser->parse($_);
}
$parser->parse_complete();

ok 1, "no wrong free, RT#70640";
done_testing();

__DATA__
{
    "key1": "1",
    "key2": 1,
    "mapping": "{\"users\":{\"looks\":{\"properties\":{\"title\":{\"type\":\"string\"},\"items\":{\"type\":\"string\"},\"rawdate\":{\"type\":\"long\"},\"best\":{\"type\":\"string\"},\"UserID\":{\"type\":\"string\"},\"photo\":{\"type\":\"string\"}}},\"friends\":{\"properties\":{\"friendID\":{\"type\":\"string\"},\"UserID\":{\"type\":\"string\"}}},\"wish\":{\"properties\":{\"id\":{\"type\":\"string\"},\"clone\":{\"dynamic\":\"true\",\"properties\":{\"shop\":{\"type\":\"string\"},\"offerCategoryId\":{\"type\":\"string\"},\"param\":{\"dynamic\":\"true\",\"properties\":{\"content\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"}}},\"currencyId\":{\"type\":\"string\"},\"variations\":{\"dynamic\":\"true\",\"properties\":{\"variation\":{\"dynamic\":\"true\",\"properties\":{\"vendorCode\":{\"type\":\"string\"},\"order_article\":{\"type\":\"string\"},\"color\":{\"type\":\"string\"},\"color_image\":{\"type\":\"string\"},\"order_size\":{\"type\":\"string\"},\"order_price\":{\"type\":\"string\"},\"url\":{\"type\":\"string\"},\"size\":{\"type\":\"string\"}}}}},\"kid\":{\"type\":\"long\"},\"child\":{\"type\":\"long\"},\"id\":{\"type\":\"long\"},\"is_new\":{\"type\":\"string\"},\"catalog_image\":{\"type\":\"string\"},\"description\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"length\":{\"type\":\"string\"},\"offerCategoryName\":{\"type\":\"string\"},\"baby\":{\"type\":\"long\"},\"necklineForm\":{\"type\":\"string\"},\"hood\":{\"type\":\"string\"},\"popularity\":{\"type\":\"long\"},\"sizeList\":{\"type\":\"string\"},\"oldPrice\":{\"type\":\"long\"},\"article_group_number\":{\"type\":\"string\"},\"vendor\":{\"type\":\"string\"},\"elegance\":{\"type\":\"string\"},\"colorList\":{\"type\":\"string\"},\"male\":{\"type\":\"long\"},\"currencyRate\":{\"type\":\"long\"},\"available\":{\"type\":\"long\"},\"adult\":{\"type\":\"string\"},\"sysSize\":{\"type\":\"string\"},\"picture\":{\"type\":\"string\"},\"shopURL\":{\"type\":\"string\"},\"price\":{\"type\":\"long\"},\"season\":{\"type\":\"string\"},\"female\":{\"type\":\"string\"},\"typePrefix\":{\"type\":\"string\"},\"categories\":{\"dynamic\":\"true\",\"properties\":{\"category\":{\"dynamic\":\"true\",\"properties\":{\"id\":{\"type\":\"string\"},\"content\":{\"type\":\"string\"},\"parentId\":{\"type\":\"long\"}}}}},\"sleeveLength\":{\"type\":\"string\"}}},\"rawdate\":{\"type\":\"long\"},\"UserID\":{\"type\":\"string\"}}},\"fav\":{\"properties\":{\"id\":{\"type\":\"string\"},\"clone\":{\"dynamic\":\"true\",\"properties\":{\"shop\":{\"type\":\"string\"},\"offerCategoryId\":{\"type\":\"string\"},\"param\":{\"dynamic\":\"true\",\"properties\":{\"content\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"}}},\"currencyId\":{\"type\":\"string\"},\"variations\":{\"dynamic\":\"true\",\"properties\":{\"variation\":{\"dynamic\":\"true\",\"properties\":{\"vendorCode\":{\"type\":\"string\"},\"order_article\":{\"type\":\"string\"},\"color\":{\"type\":\"string\"},\"color_image\":{\"type\":\"string\"},\"order_size\":{\"type\":\"string\"},\"order_price\":{\"type\":\"string\"},\"url\":{\"type\":\"string\"},\"size\":{\"type\":\"string\"}}}}},\"kid\":{\"type\":\"long\"},\"child\":{\"type\":\"long\"},\"id\":{\"type\":\"long\"},\"is_new\":{\"type\":\"string\"},\"catalog_image\":{\"type\":\"string\"},\"description\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"length\":{\"type\":\"string\"},\"offerCategoryName\":{\"type\":\"string\"},\"baby\":{\"type\":\"long\"},\"necklineForm\":{\"type\":\"string\"},\"hood\":{\"type\":\"string\"},\"popularity\":{\"type\":\"long\"},\"sizeList\":{\"type\":\"string\"},\"oldPrice\":{\"type\":\"long\"},\"article_group_number\":{\"type\":\"string\"},\"vendor\":{\"type\":\"string\"},\"elegance\":{\"type\":\"string\"},\"colorList\":{\"type\":\"string\"},\"male\":{\"type\":\"long\"},\"currencyRate\":{\"type\":\"long\"},\"available\":{\"type\":\"long\"},\"adult\":{\"type\":\"string\"},\"sysSize\":{\"type\":\"string\"},\"picture\":{\"type\":\"string\"},\"shopURL\":{\"type\":\"string\"},\"price\":{\"type\":\"long\"},\"season\":{\"type\":\"string\"},\"female\":{\"type\":\"string\"},\"typePrefix\":{\"type\":\"string\"},\"categories\":{\"dynamic\":\"true\",\"properties\":{\"category\":{\"dynamic\":\"true\",\"properties\":{\"id\":{\"type\":\"string\"},\"content\":{\"type\":\"string\"},\"parentId\":{\"type\":\"long\"}}}}},\"sleeveLength\":{\"type\":\"string\"}}},\"rawdate\":{\"type\":\"long\"},\"UserID\":{\"type\":\"string\"}}},\"frequests\":{\"properties\":{\"friendID\":{\"type\":\"string\"},\"UserID\":{\"type\":\"string\"}}},\"user\":{\"properties\":{\"tmp\":{\"type\":\"boolean\"},\"rawdate\":{\"type\":\"long\"},\"UserName\":{\"type\":\"string\"}}},\"trial\":{\"properties\":{\"id\":{\"type\":\"string\"},\"color\":{\"type\":\"string\"},\"rawdate\":{\"type\":\"long\"},\"UserID\":{\"type\":\"string\"},\"size\":{\"type\":\"string\"}}},\"comments\":{\"properties\":{\"text\":{\"type\":\"string\"},\"attach_id\":{\"type\":\"string\"},\"rawdate\":{\"type\":\"long\"},\"UserID\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"date\":{\"type\":\"string\"},\"ourUserID\":{\"type\":\"string\"}}}},\"vitrina\":{\"offer\":{\"properties\":{\"shop\":{\"type\":\"string\"},\"_source\":{\"dynamic\":\"true\",\"properties\":{\"shop\":{\"type\":\"string\"},\"offerCategoryId\":{\"type\":\"string\"},\"currencyId\":{\"type\":\"string\"},\"variations\":{\"dynamic\":\"true\",\"properties\":{\"variation\":{\"dynamic\":\"true\",\"properties\":{\"vendorCode\":{\"type\":\"string\"},\"order_article\":{\"type\":\"string\"},\"color\":{\"type\":\"string\"},\"color_image\":{\"type\":\"string\"},\"order_size\":{\"type\":\"string\"},\"order_price\":{\"type\":\"string\"},\"url\":{\"type\":\"string\"},\"size\":{\"type\":\"string\"}}}}},\"kid\":{\"type\":\"long\"},\"child\":{\"type\":\"long\"},\"id\":{\"type\":\"long\"},\"is_new\":{\"type\":\"string\"},\"description\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"length\":{\"type\":\"string\"},\"offerCategoryName\":{\"type\":\"string\"},\"baby\":{\"type\":\"long\"},\"necklineForm\":{\"type\":\"string\"},\"hood\":{\"type\":\"string\"},\"popularity\":{\"type\":\"long\"},\"sizeList\":{\"type\":\"string\"},\"local_delivery_cost\":{\"dynamic\":\"true\",\"type\":\"object\"},\"oldPrice\":{\"type\":\"long\"},\"article_group_number\":{\"type\":\"string\"},\"vendor\":{\"type\":\"string\"},\"elegance\":{\"type\":\"string\"},\"colorList\":{\"type\":\"string\"},\"male\":{\"type\":\"long\"},\"currencyRate\":{\"type\":\"long\"},\"available\":{\"type\":\"long\"},\"adult\":{\"type\":\"string\"},\"sysSize\":{\"type\":\"string\"},\"picture\":{\"type\":\"string\"},\"shopURL\":{\"type\":\"string\"},\"price\":{\"type\":\"long\"},\"season\":{\"type\":\"string\"},\"female\":{\"type\":\"string\"},\"typePrefix\":{\"type\":\"string\"},\"categories\":{\"dynamic\":\"true\",\"properties\":{\"category\":{\"dynamic\":\"true\",\"properties\":{\"id\":{\"type\":\"string\"},\"content\":{\"type\":\"string\"},\"parentId\":{\"type\":\"long\"}}}}},\"delivery\":{\"dynamic\":\"true\",\"type\":\"object\"},\"sleeveLength\":{\"type\":\"string\"}}},\"param\":{\"dynamic\":\"true\",\"properties\":{\"content\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"}}},\"offerCategoryId\":{\"type\":\"string\"},\"currencyId\":{\"type\":\"string\"},\"variations\":{\"dynamic\":\"true\",\"properties\":{\"variation\":{\"dynamic\":\"true\",\"properties\":{\"vendorCode\":{\"type\":\"string\"},\"order_article\":{\"type\":\"string\"},\"color\":{\"type\":\"string\"},\"color_image\":{\"type\":\"string\"},\"order_size\":{\"type\":\"string\"},\"order_price\":{\"type\":\"string\"},\"url\":{\"type\":\"string\"},\"size\":{\"type\":\"string\"}}}}},\"kid\":{\"type\":\"long\"},\"child\":{\"type\":\"long\"},\"id\":{\"type\":\"long\"},\"is_new\":{\"type\":\"string\"},\"catalog_image\":{\"type\":\"string\"},\"description\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"offerCategoryName\":{\"type\":\"string\"},\"length\":{\"type\":\"string\"},\"baby\":{\"type\":\"long\"},\"necklineForm\":{\"type\":\"string\"},\"hood\":{\"type\":\"string\"},\"popularity\":{\"type\":\"long\"},\"sizeList\":{\"type\":\"string\"},\"oldPrice\":{\"type\":\"long\"},\"local_delivery_cost\":{\"dynamic\":\"true\",\"type\":\"object\"},\"article_group_number\":{\"type\":\"string\"},\"vendor\":{\"type\":\"string\"},\"elegance\":{\"type\":\"string\"},\"colorList\":{\"type\":\"string\"},\"male\":{\"type\":\"long\"},\"currencyRate\":{\"type\":\"long\"},\"_index\":{\"type\":\"string\"},\"available\":{\"type\":\"long\"},\"adult\":{\"type\":\"string\"},\"sysSize\":{\"type\":\"string\"},\"picture\":{\"type\":\"string\"},\"shopURL\":{\"type\":\"string\"},\"price\":{\"type\":\"long\"},\"season\":{\"type\":\"string\"},\"female\":{\"type\":\"string\"},\"typePrefix\":{\"type\":\"string\"},\"categories\":{\"dynamic\":\"true\",\"properties\":{\"category\":{\"dynamic\":\"true\",\"properties\":{\"id\":{\"type\":\"string\"},\"content\":{\"type\":\"string\"},\"parentId\":{\"type\":\"long\"}}}}},\"delivery\":{\"dynamic\":\"true\",\"type\":\"object\"},\"sleeveLength\":{\"type\":\"string\"}}}}}"
}
